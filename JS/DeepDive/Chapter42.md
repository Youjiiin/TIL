# 비동기 프로그래밍

## 동기 처리와 비동기 처리
### 동기 처리
- 함수를 호출하면, 함수 코드가 평가되어 함수 실행 컨텍스트 스택에 푸시되고 함수 코드가 실행된다. 그러나 JavaScript 엔진은 단일 실행 컨텍스트 스택을 사용하기 때문에, 동시에 여러 개의 함수를 실행할 수 없다. (싱글 스레드 방식)
- 현재 실행 중인 작업(태스크)이 완료될 때까지 다음 태스크는 대기해야 하는 방식이 **동기 처리**이다.
- 실행 순서가 보장된다는 장점이 있지만, 앞의 태스크가 종료할 때까지 이 후 태스크들이 블로킹 된다는 단점이 있다.

### 비동기 처리
- 현재 실행 중인 태스크가 완료되지 않았더라도 다음 태스크를 실행할 수 있는 방식을 **비동기 처리**라 한다.
- 비동기 함수는 일반적으로 **콜백 패턴**을 사용한다. 
> 콜백 패턴
> 함수가 다른 함수의 인자로 전달되고, 특정 작업이 완료된 후 호출되는 방식. 주로 비동기 작업에서 사용되며, 작업이 완료된 시점에 원하는 동작을 실행하거나 결과를 처리할 수 있다.
- 예시: `setTimeout`, `setInterval`, `HTTP 요청`, `이벤트 핸들러` 등.

## 이벤트 루프와 태스크 큐
- 브라우저나 Node.js 환경에서 마치 여러 작업이 동시에 수행되는 것처럼 보이는 것은 이벤트 루프 덕분이다. 이벤트 루프는 JavaScript가 동시성을 지원할 수 있게 해주는 메커니즘이다.
- JS엔진
    - `콜스택`: 실행 컨텍스트 스택. 함수가 호출될 때 실행 컨텍스트가 스택에 푸시되고, 실행이 완료되면 팝된다.
    - `힙`: 객체가 저장되는 메모리 공간. 콜 스택의 실행 컨텍스트가 힙에 저장된 객체를 참조한다.
- 비동기 작업의 실행 자체는 JS 엔진이 아닌 브라우저 또는 Node.js가 담당한다. 이는 타이머 설정, 태스크 큐 관리, 그리고 콜백 함수 등록 등을 처리한다.
    - `태스크 큐`: setTimeout, setInterval 같은 비동기 함수들의 콜백 함수 또는 이벤트 핸들러가 일시적으로 대기하는 큐.
    - `이벤트 루프`: 콜 스택이 비어 있는지, 태스크 큐에 대기 중인 함수가 있는지 계속 확인하는 역할을 한다. 콜 스택이 비어있고, 태스크 큐에 함수가 대기 중이라면 이벤트 루프는 그 함수를 콜 스택으로 옮겨 실행한다.

### setTimeout 실행 순서
1. **전역 코드 실행**: 자바스크립트가 코드를 처음 실행하면, 전역 실행 컨텍스트가 생성되고 콜 스택에 푸시됩니다.

2. **setTimeout 함수 호출**: setTimeout 함수가 호출되면, 이 함수는 콜 스택에 올라가지만 바로 실행되지는 않고, 브라우저의 Web API로 타이머를 설정한 후 콜백 함수(이후 실행할 함수)를 태스크 큐에 보내 대기시킵니다. 이 타이머는 브라우저에서 관리합니다.

3. **타이머 만료 후 태스크 큐로 이동**: 설정된 타이머 시간이 지나면, 타이머가 만료되어 태스크 큐에 있던 콜백 함수가 실행 준비 상태가 됩니다. 그러나 이 콜백 함수는 바로 실행되지 않고, 콜 스택이 비어 있는지 확인하는 과정이 필요합니다.

4. **콜 스택이 비면 이벤트 루프가 태스크 큐에서 콜백 함수 이동**: 전역 코드나 다른 동기 작업이 모두 완료되어 콜 스택이 비어있으면, 이벤트 루프가 태스크 큐에서 대기 중이던 콜백 함수를 콜 스택으로 옮깁니다. 그 후 해당 콜백 함수가 실행됩니다.